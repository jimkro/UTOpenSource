<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>有聲書繪本</title>
        <script>
            // 初始化頁數 currentPage，初始值為 0
            var currentPage = 0;
            var pageAudio = new Audio(); // 背景音樂
            var readAudio = new Audio(); // 朗讀音檔

            // 更新頁面中的頁數顯示和圖片
            function updatePageDisplay() {
                // 更新頁數顯示
                document.getElementById("pageNumber").innerText = currentPage;
                // 更新圖片來源
                document.getElementById("pageImage").src = "graphics/" + currentPage + ".jpg";

                // 1. 控制按鈕的顯示與隱藏
                var startBtn = document.getElementById("startButton");
                var navBtns = document.getElementById("navigationButtons");

                if (currentPage === 0) {
                    // 第 0 頁：只顯示「開始閱讀」按鈕
                    startBtn.style.display = 'inline-block';
                    navBtns.style.display = 'none';
                } else {
                    // 第 1 頁及以後：顯示導航按鈕
                    startBtn.style.display = 'none';
                    navBtns.style.display = 'inline-block';
                }

                // 2. 載入當前頁的音樂和朗讀音檔
                pageAudio.loop = true; // 背景音樂循環
                
                pageAudio.pause(); 
                pageAudio.src = "music/music" + currentPage + ".mp3"; 
                pageAudio.load(); 

                readAudio.pause();
                readAudio.src = "speech/speech" + currentPage + ".mp3"; 
                readAudio.load(); 
            }

            // *** 新增：處理從第 0 頁到第 1 頁的轉換和播放 ***
            function startReading() {
                if (currentPage === 0) {
                    currentPage = 1; // 跳到第 1 頁
                    updatePageDisplay(); // 更新到第 1 頁的圖片和載入音樂

                    // 點擊「開始」按鈕後，自動播放第 1 頁的音樂
                    pageAudio.play().catch(e => console.error("無法播放背景音樂:", e));
                }
            }

            // 按下 "下一頁" 按鈕
            function nextPage() {
                // 修正：如果目前在第 0 頁，應該呼叫 startReading()
                if (currentPage === 0) {
                    startReading();
                    return;
                }

                if(currentPage < 19){
                    currentPage += 1; 
                    updatePageDisplay();
                    pageAudio.play().catch(e => console.error("無法播放背景音樂:", e));
                }
            }

            // 按下 "上一頁" 按鈕
            function prevPage() {
                if(currentPage > 1){ // 確保不會回到第 0 頁，除非你希望它回到第 0 頁
                    currentPage -= 1; 
                    updatePageDisplay();
                    pageAudio.play().catch(e => console.error("無法播放背景音樂:", e));
                } else if (currentPage === 1) {
                    // 如果在第 1 頁按「上一頁」，回到封面 (第 0 頁)
                    currentPage = 0;
                    updatePageDisplay();
                    pageAudio.pause(); // 封面通常沒有背景音樂
                }
                // 如果在第 0 頁按「上一頁」，不做任何事
            }

            // 按下 "閱讀" 按鈕，只播放朗讀音檔
            function read(){
                // 先確保背景音樂停止，避免干擾朗讀
                pageAudio.pause(); 
                
                // 播放朗讀音檔
                readAudio.play().catch(e => console.error("無法播放朗讀音檔:", e));
                
                // 朗讀結束後，可以考慮重新播放背景音樂
                readAudio.onended = function() {
                    if(currentPage !== 0) { // 確保不在封面頁
                        pageAudio.play().catch(e => console.error("朗讀結束後無法恢復背景音樂:", e));
                    }
                };
            }

            window.onload = updatePageDisplay;
        </script>
    </head>

    <style>
        .no_border_btn{
            border: none;
            background: transparent;
            padding: 0;
            cursor: pointer;
            width: 160px;
            height: 80px;
        }

        .no_border_img{
            width: 100%;
            height: 100%;
        }
    </style>

    <body onload="updatePageDisplay()">
        <h1>有聲書繪本</h1>
        
        <p>目前頁數：<span id="pageNumber"></span></p>

        <img id="pageImage" src="" alt="對應的圖片將顯示在這裡" width="500">
        <br>

        <div id="controls">
            <button id="startButton" onclick="startReading()">
                開始閱讀
            </button>

            <div id="navigationButtons" style="display: none;">
                <button class = "no_border_btn" onclick="prevPage()">
                    <img class = "no_border_img" src="graphics/left.jpg" alt="上一頁">
                </button>
                <button class = "no_border_btn" onclick="read()">
                    <img class = "no_border_img" src="graphics/read.jpg" alt="閱讀">
                </button>
                <button class = "no_border_btn" onclick="nextPage()">
                    <img class = "no_border_img" src="graphics/right.jpg" alt="下一頁">
                </button>
            </div>
        </div>
    </body>
</html>